<!--
title: Network Design
description: Detailed description of network design and configuration.
published: true
date: 2020-12-11T12:59:55.042Z
tags: 
editor: ckeditor
dateCreated: 2020-10-13T02:48:12.542Z
-->

<h1>Overview</h1>
<p>The network infrastructure provides wireless access for users, streaming devices, and IOT devices. &nbsp;There are three access points in the house, each utilize different channels to minimize interference. &nbsp;Wired access is available in the office and family room, via two switches and a router. &nbsp;</p>
<h2>WiFi Access</h2>
<p>The network has three separate SSIDs for specific purposes:</p>
<ol>
  <li><i><strong>WYSECHOICE - </strong>Trusted access for human users</i></li>
  <li><i><strong>WYSECHOICE_STREAMING - </strong>Untrusted access for streaming devices</i></li>
  <li><i><strong>WYSECHOICE_IOT - </strong>Untrusted access for IOT devices</i></li>
</ol>
<p>Each of the SSIDs is on their own VLAN to allow customization of the group's support. &nbsp;The primary customization is to only allow the <i><strong>WYSECHOICE</strong></i> VLAN to have access to the full network. &nbsp;The other VLANs may be running proprietary software, that could be compromised, so they are prevented from reaching the <i><strong>WYSECHOICE</strong></i> VLAN. &nbsp;The <i><strong>WYSECHOICE_STREAMING</strong> &nbsp;</i>VLAN was separated to potentially prioritize traffic for a better streaming experience. &nbsp; Currently, it is differentiated by only supporting 5G access, and<i> &nbsp;<strong>WYSECHOICE_IOT&nbsp;</strong> </i>is limited to 2G<i>.</i></p>
<h2>Wired Access</h2>
<p>Wired access is available via the Unifi Dream Machine router ports, a network switch in the office, and another switch in the family room. &nbsp;All wired access is placed on the <i><strong>WYSECHOICE_WIRED</strong></i> VLAN, and has full access to the network.</p>
<p>The network cabling comes in at the office cable modem, then goes to the Unifi Dream Machine router. &nbsp;Two router ports are utilized to run cabling to the access points in both the living room and family room. &nbsp;</p>
<p>Ports are available at the router in the office, an 8-port switch in the office, and a 4-port switch in the family room. &nbsp;One of the ports on the family room switch is utilized for family room access point.</p>
<h2>MACVLans</h2>
<p>The network contains two MACVLans, one VLAN hosted on a Raspberry Pi 4 running Docker containers, and another on the router using Podman. &nbsp;All containers in these MACVLans have their own MAC addresses and appear as if they were physically connected to the network.</p>
<p><span class="text-big"><mark class="marker-yellow"><strong>NOTE:</strong></mark></span><mark class="marker-yellow">&nbsp;<strong> The untrusted networks should not have access to the MACVLans. &nbsp;This should be updatedâ€¦</strong></mark></p>
<h2>Network Diagram</h2>
<figure class="image"><img src="/wysechoicevlans.png"></figure>
<p>&nbsp;</p>
<h2>Pi-Hole on UDM</h2>
<p><a href="https://github.com/boostchicken/udm-utilities/tree/master/on-boot-script">https://github.com/boostchicken/udm-utilities/tree/master/on-boot-script</a></p>
<p><a href="https://github.com/boostchicken/udm-utilities/tree/master/run-pihole">https://github.com/boostchicken/udm-utilities/tree/master/run-pihole</a></p>
<p><a href="http://192.168.5.3/admin/queries.php">http://192.168.5.3/admin/queries.php</a></p>
<p><a href="https://github.com/boostchicken/udm-utilities/blob/master/cni-plugins/20-dns.conflist">https://github.com/boostchicken/udm-utilities/blob/master/cni-plugins/20-dns.conflist</a></p>
<p><a href="/20-dns.conflist">https://github.com/boostchicken/udm-utilities/blob/master/dns-common/on_boot.d/10-dns.sh</a></p>
<p><a href="/10-dns.sh">10-dns.sh</a></p>
<p><a href="/20-dns.conflist">20-dns.conflist</a></p>
<p><a href="/pihole.sh">pihole.sh</a></p>
<figure class="image"><img src="/piholebackup.png"></figure>
<h2>Scripting the Pi-Hole Backup for use with Grafana:</h2>
<p>Get the WEBPASSWORD from /etc/pihole/setupVars.conf in the podman container:</p>
<p>WEBPASSWORD=c3c6db3026a6ddb15d603ddd2fe20521ea5656d3608e387a7637185b2867bb26</p>
<p>curl -ks "http://192.168.5.3/admin/api.php?overTimeData10mins&amp;auth=c3c6db3026a6ddb15d603ddd2fe20521ea5656d3608e387a7637185b2867bb26"</p>
<p>&nbsp;</p>
<p>https://raw.githubusercontent.com/anudeepND/whitelist/master/domains/whitelist.txt &nbsp;=&gt; /etc/pihole/whitelist.txt on container.</p>
<p>root@pi:~# wget https://raw.githubusercontent.com/anudeepND/whitelist/master/domains/whitelist.txt</p>
<p>root@pi:~# while read -r line; do pihole -w $line; done &lt;whitelist.txt</p>
<p><a href="/pi-hole-pi_hole-teleporter_2020-10-24_14-15-20.tar.gz">/pi-hole-pi_hole-teleporter_2020-10-24_14-15-20.tar.gz</a></p>
<h2>Dream Machine Support File</h2>
<ol>
  <li>openssl enc -d -in "unifi-20190707-2225.supp" -out "unifi-20190707-2225.supp.tmp" -aes-128-cbc -K 626379616e676b6d6c756f686d617273 -iv 75626e74656e74657270726973656170 -nosalt -nopad</li>
  <li>zip -FF "unifi-20190707-2225.supp.tmp" --out supp</li>
  <li>Is this a single-disk archive? (y/n): y</li>
</ol>
<p>Reference: <a href="https://community.ui.com/questions/Extracting-logs-from-the-support-file/9cae86af-b73a-4a1c-8d41-4ba4b0ab45ad">https://community.ui.com/questions/Extracting-logs-from-the-support-file/9cae86af-b73a-4a1c-8d41-4ba4b0ab45ad</a></p>
<h2>API Browser</h2>
<p><a href="https://github.com/Art-of-WiFi/UniFi-API-browser">https://github.com/Art-of-WiFi/UniFi-API-browser</a></p>
<p><a href="https://github.com/Art-of-WiFi/UniFi-API-client">https://github.com/Art-of-WiFi/UniFi-API-client</a></p>
<p><a href="https://community.ui.com/questions/UniFi-API-browser-tool-updates-and-discussion/30927150-dd44-40f7-96c0-9fbbfc673fb3?page=26">https://community.ui.com/questions/UniFi-API-browser-tool-updates-and-discussion/30927150-dd44-40f7-96c0-9fbbfc673fb3?page=26</a></p>
<h2>General</h2>
<ul>
  <li>UniFi Dream Machine<ul>
      <li>Model: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UniFi Dream Machine</li>
      <li>Version: &nbsp;&nbsp;&nbsp;&nbsp;1.5.6.2150</li>
      <li>MAC Address: 74:83:c2:d6:c9:1b</li>
      <li>IP Address: &nbsp;68.9.160.37</li>
      <li>Hostname: &nbsp;&nbsp;&nbsp;DreamMachine</li>
      <li>Name: dreammachine.wysechoice.net (Planned)</li>
      <li>Firmware: v1.5.6</li>
      <li>MAC Address:</li>
      <li>Local IP Address: 192.168.1.1</li>
      <li>Networks:<ul>
          <li>WYSECHOICE_WIRED (VLAN 1 - Default)<ul>
              <li>192.168.1.1/24</li>
              <li>DHCP: 192.168.1.6 - 192.168.1.254</li>
              <li>DNS: 8.8.4.4, 8.8.8.8, 10.0.0.1</li>
            </ul>
          </li>
          <li>DockerNet (VLAN 40)<ul>
              <li>192.168.40.1/24</li>
              <li>DHCP: N/A</li>
              <li>DNS: N/A</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Wireless Networks:<ul>
          <li>WYSECHOICE (VLAN 10)<ul>
              <li>192.168.10.1/24</li>
              <li>DHCP: 192.168.10.6 - 192.168.10.254</li>
              <li>DNS: 8.8.4.4, 8.8.8.8, 10.0.0.1</li>
            </ul>
          </li>
          <li>WYSECHOICE_IOT (VLAN 20)<ul>
              <li>192.168.20.1/24</li>
              <li>DHCP: 192.168.20.6 - 192.168.20.254</li>
              <li>DNS: 8.8.4.4, 8.8.8.8, 10.0.0.1</li>
            </ul>
          </li>
          <li>WYSECHOICE_STREAMING<ul>
              <li>192.168.30.1/24</li>
              <li>DHCP: 192.168.30.6-192.168.30.254</li>
              <li>DNS: 8.8.4.4, 8.8.8.8, 10.0.0.1</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Wireless Channels: 1 Low (2G), 48 medium VHT40 (5G)</li>
    </ul>
  </li>
  <li>UniFi AP-AC-Lite (9/12/20)<ul>
      <li>Model: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UAP-AC-Lite</li>
      <li>Version: &nbsp;&nbsp;&nbsp;&nbsp;5.35.0.12205</li>
      <li>MAC Address: 80:2a:a8:86:fc:98</li>
      <li>IP Address: &nbsp;192.168.1.29</li>
      <li>Hostname: &nbsp;&nbsp;&nbsp;FamilyRoomAP</li>
      <li>Wireless Channels: 11 Low (2G), 36 Medium VHT80 (5G)</li>
    </ul>
  </li>
  <li>Unifi AP-AC-Lite (9/12/20)<ul>
      <li>Model: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UAP-AC-Lite</li>
      <li>Version: &nbsp;&nbsp;&nbsp;&nbsp;5.35.0.12205</li>
      <li>MAC Address: 80:2a:a8:86:fb:37</li>
      <li>IP Address: &nbsp;192.168.1.69</li>
      <li>Hostname: &nbsp;&nbsp;&nbsp;LivingRoomAP</li>
      <li>Wireless Channels: 6&nbsp;Low (2G), 40&nbsp;Medium VHT40 (5G)</li>
    </ul>
  </li>
</ul>
<p><a href="/home/DockerNet">DockerNet Creation and Configuration</a></p>
